{% extends "base.html" %}

{% block content %}
<h1 class="my-4">User List</h1>
<table class="table table-striped table-bordered">
    <thead class="thead-dark">
        <tr>
            <th>Staff No</th>
            <th>Staff Name</th>
            <th>Is Admin</th>
            <th>Created At</th>
            <th>Updated At</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for user in users %}
        <tr>
            <td>{{ user.staffno }}</td>
            <td>{{ user.staffname }}</td>
            <td>{{ user.isadmin }}</td>
            <td>{{ user.created_at }}</td>
            <td>{{ user.updated_at }}</td>
            <td>
                <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editUserModal" data-staffno="{{ user.staffno }}" data-staffname="{{ user.staffname }}" data-isadmin="{{ user.isadmin }}">Edit</button>
                <form action="{{ url_for('user.delete_user', staffno=user.staffno) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
                <button type="button" class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#viewUserModal" data-staffno="{{ user.staffno }}" data-staffname="{{ user.staffname }}" data-isadmin="{{ user.isadmin }}" data-created_at="{{ user.created_at }}" data-updated_at="{{ user.updated_at }}">View</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<button type="button" class="btn btn-info my-3" data-toggle="modal" data-target="#userFormModal">Add User</button>

<!-- Add User Modal -->
<div class="modal fade" id="userFormModal" tabindex="-1" role="dialog" aria-labelledby="userFormModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="userFormModalLabel">User Form</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% include 'user/user_form.html' %}
      </div>
    </div>
  </div>
</div>

<!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" role="dialog" aria-labelledby="editUserModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% include 'user/user_form.html' %}
      </div>
    </div>
  </div>
</div>

<!-- View User Modal -->  
<div class="modal fade" id="viewUserModal" tabindex="-1" role="dialog" aria-labelledby="viewUserModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewUserModalLabel">View User</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% include 'user/user_view.html' %}
      </div>
    </div>
  </div>
</div>

<script>
  $('#viewUserModal').on('show.bs.modal', function (event) {
    var button = $(event.relatedTarget); // Button that triggered the modal
    var staffno = button.data('staffno');
    var staffname = button.data('staffname');
    var isadmin = button.data('isadmin');
    var createdAt = button.data('created_at');
    var updatedAt = button.data('updated_at');

    var modal = $(this);
    modal.find('.modal-body #staffno').text(staffno);
    modal.find('.modal-body #staffname').text(staffname);
    modal.find('.modal-body #isadmin').text(isadmin);
    modal.find('.modal-body #created_at').text(createdAt);
    modal.find('.modal-body #updated_at').text(updatedAt);
  });
</script>
{% endblock %}